    {% extends 'account/base.html' %}
    {% block main-content %}


    {% load static %}
    <style>
        .card-header {
                display: flex;
                align-items: center;
        }
        .container-xxl {
                margin-left: -490px; / Adjust the left margin as needed /
                margin-top:50px;


        }
        .hidden {
              display: none;
        }

        .container-xxl{
                margin-top:45px;


        }
    </style>
    <div class="post d-flex flex-column-fluid ml-5" id="kt_post">
        <div class="container-xxl">
            <div class="row mt-5 mb-2 ml-1">
                <h3 class="page-title d-flex align-items-center flex-wrap me-20 mb-300 mb-lg-0">Employee Task list</h3>
            </div>
            <div class="card">
                <div class="card-header border-1 pt-6" style="display: flex; align-items: center;">
                    <form action="" method="GET">
                        <div class="card-title">
                            <div class="d-flex align-items-center position-relative my-1">
                                <div class="input-group ml-5" id="kt_daterangepicker_6">
                                    <input type="text" name="empdate" id="empdate" value="" autocomplete="off"
                                           class="form-control" readonly="" placeholder="Select date range"
                                           fdprocessedid="oa96j5">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="la la-calendar-check-o"></i></span>
                                    </div>
                                </div>
                                <select class="form-select ml-5" id="priority_search" null="" name="priority_search"
                                        aria-label="Select example" fdprocessedid="3iv7sq"  style="display: inline-block;height:40px;border-radius:7px;max-width:200px;border:1px solid #ccc;">
                                    <option value="">Select a Priority Search...</option>
                                    <option value="1">Low</option>
                                    <option value="2">Medium</option>
                                    <option value="3">High</option>
                                    <option value="4">Urgent</option>
                                </select>
                                <button style="height:40px;margin-left:1px" class="button" class="button:hover" type="submit"  name="submit" onclick="searchTasks()" fdprocessedid="n1txyw">Search</button>

                            </div>
                        </div>
                    </form>
                    <div class="card-toolbar ml-auto">
                        <div class="d-flex justify-content-end" data-kt-customer-table-toolbar="base">
                            <div class="menu menu-sub menu-sub-dropdown w-300px w-md-325px" data-kt-menu="true"
                                 id="kt-toolbar-filter"></div>
                            <button type="button"  class= "button" class="button:hover" class="btn btn-primary" data-bs-toggle="modal"
                                    data-bs-target="#kt_modal_add_customer" fdprocessedid="e02ael"><a href="{% url 'add-emp-task' %}" class="text-white" style="text-decoration:none;">Add Task Details</a>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="new" id="leavesearch">
                    <div class="card-body pt-0">
                        <div id="kt_customers_table_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                            <div class="table-responsive">
                                <table class="table align-middle table-row-dashed fs-6 gy-5 dataTable no-footer"
                                       id="kt_customers_table">
                                    <thead>
                                    <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                        <th class="min-w-125px sorting" style="width: 171.516px;">Sr no</th>
                                        <th class="min-w-125px sorting" style="width: 171.516px;">Employee Name</th>
                                        <th class="min-w-125px sorting" style="width: 171.516px;">Card Link</th>
                                        <th class="min-w-125px sorting" style="width: 171.516px;">Assign Date</th>
                                        <th class="min-w-125px sorting" style="width: 171.516px;">Mentor</th>
                                        <th class="min-w-125px sorting" style="width: 171.516px;">priority</th>
                                        <th class="text-end min-w-70px sorting_disabled" style="width: 133.062px;">Actions
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody class="fw-bold text-gray-600">
                                    <tr>
                                        <td colspan="10">There are no records found</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start"></div>
                    <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                        <div class="dataTables_paginate paging_simple_numbers" id="kt_customers_table_paginate">
                            <ul class="pagination">
                                <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script>


        // Function to handle deleting a task
    function deleteTask(id) {
        $.ajax({
            url: `http://127.0.0.1:8000/emp-task/${id}/`,
            type: 'DELETE',
            success: function(result) {
                console.log(`Task with ID ${id} deleted successfully`);
                // Remove the deleted task row from the table
                $(`#task_${id}`).remove();
                // Trigger custom event for task deletion (optional)
                $(document).trigger('taskDeleted', id);
            },
            error: function(xhr, status, error) {
                console.error(`Error deleting task: ${error}`);
                // Optionally provide feedback to the user about the error
                alert(`Error deleting task: ${error}`);
            }
        });
    }


        // Function to fetch data from the API and populate the table
        function fetchDataAndPopulateTable() {
            // Fetch data and populate table
            $.ajax({
                url: 'http://127.0.0.1:8000/emp-task/',
                type: 'GET',
                success: function(data) {
                    const tableBody = $('#kt_customers_table tbody');
                    // Clear existing table rows
                    tableBody.empty();
                    // Populate table rows with data
                    data.forEach((task, index) => {
                        const row = `
                            <tr id="task_${task.id}">
                                <td>${index + 1}</td>
                                <td>${task.E_name}</td>
                                <td>${task.E_Card_Link}</td>
                                <td>${task.E_Assign_Date}</td>
                                <td>${task.E_Mentor}</td>
                                <td>${task.E_Priority}</td>
                                <td>
                                    <button class="btn btn-danger text-danger . bg-light" onclick="toggleActionMenu(${task.id})">...</button>
                                    <div id="actionMenu_${task.id}" class="action-menu hidden mt-2">
                                        <button class="btn btn-primary text-primary . bg-light"  onclick="updateTask(${task.id})">Update</button>
                                        <button  class="btn btn-danger text-danger . bg-light" style="margin-right:-200px"  onclick="deleteTask(${task.id})">Delete</button>
                                    </div>
                                </td>
                            </tr>
                            `;
                        tableBody.append(row);
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching tasks:', error);
                }
            });
        }

        // Toggle action menu
        function toggleActionMenu(taskId) {
            const actionMenu = $(`#actionMenu_${taskId}`);
            actionMenu.toggleClass('hidden');
        }

        // Click outside handler for action menu
        function clickOutsideHandler(e) {
            if (!$(e.target).closest('.action-menu').length && !$(e.target).closest('.btn-danger').length) {
                $('.action-menu').addClass('hidden');
                // Remove event listener after closing action menu
                $(document).off('click', clickOutsideHandler);
            }
        }

        // Listen for taskDeleted event and update table
        $(document).on('taskDeleted', function(event, id) {
            // Remove the deleted task row from the table
            $(`#task_${id}`).remove();
        });

        // Call the function to fetch data and populate the table when the document is ready
        $(document).ready(function() {
            fetchDataAndPopulateTable();
        });

        // Add click outside handler when action menu is toggled
        $(document).on('click', '.btn-danger', function() {
            $(document).on('click', clickOutsideHandler);
        });




</script>
{% endblock main-content %}








